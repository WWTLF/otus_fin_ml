# Отчет

- [Отчет](#отчет)
  - [Исходный код и инструкция по запуску](#исходный-код-и-инструкция-по-запуску)
  - [Pipeline загрузки и обработки](#pipeline-загрузки-и-обработки)
    - [Загрузка](#загрузка)
    - [Очистка](#очистка)
    - [Добавление фич](#добавление-фич)
      - [Список дополнительных фич](#список-дополнительных-фич)



## Исходный код и инструкция по запуску

1. [Исходный код](dashboard/dashboard.py)
2. Для запуска необходимо выполнить команду: `streamlit run dashboard.py`
3. Для дозагрузки данных нажать кнопку **Update stock prices**


## Pipeline загрузки и обработки

```
┌────────┐   ┌────┐   ┌──────────┐    ┌──────┐   ┌────┐     ┌──────┐    ┌────────────┐  ┌────────┐
│        │   │    │   │Get rid of│    │Insert│   │    │     │Filter│    │            │  │        │
│Download├──►│ffil├──►│outliers  ├───►│To DB │──►│Load├────►│In UI ├───►│Add Featrues├─►│Build IU│
│        │   │    │   │          │    │      │   │    │     │      │    │            │  │        │
└────────┘   └────┘   └──────────┘    └──────┘   └────┘     └──────┘    └────────────┘  └────────┘
```

### Загрузка

1. Данные загружаются по каждой ценной бумаге с помощью библиотеки Yahoo Finance
2. Затем очищаются от выбрасов и затем сохраняются в файловую базу данных DuckDB в файл `stock_data`
3. Данные загружатся с учетом последней загруженной даты для конкретной ценной бумаги, но не больше чем за год. 


### Очистка

1. Метод `get_rid_of_outliers` помечает выбросы по цене закрытия методом межквартильного размаха (IQR), если в позиции был выброс, то значение в колонке is_outlier устанавливается в True, эта колонка также сохраняется в БД, для дальнейшего использования в ML
2. Если в позиции был выброс, то значение цены закрытия заменяется средним значением за пять дней (от -2 дня до +2 для от текущего дня)
3. Если после очистки выбросов значение NaN, то оно заполняется предыдущем значением


### Добавление фич

1. Данные для фич и UI загружаются на основе выбранного диапазона в UI
2. Далее в данные добавляются дополнительные фичи с помощью метода `add_features`, он будет использоваться в дальнейшем для формирования обучающий выброки
3. Данные отображаются в таблице и на графике

#### Список дополнительных фич

|Колонка|Значение|
|-------|--------|
|scaled_close_price|Нормализованная цена закрытия|
|daily_return|Доходность по каждой позиции в разрезе ценной бумаги|
|macd| Moving Average Convergence/Divergence|
|macd_signal_line|Сигнал MACD (линия)|
|macd_signal|Сигнал MACD(1-покупаем, -1 - продаем, 0 - удерживаем позицию)|
|tema| Triple Exponential Moving Average|
|is_outlier|Флаг сигнализирующий о том, что в данной позиции был выброс|

